# ì½˜ì„œíŠ¸ ì˜ˆì•½ í”„ë¡œì íŠ¸
ì´ ì‹œìŠ¤í…œì€ í† í° ê¸°ë°˜ì˜ ì¸ì¦ ë° ëŒ€ê¸°ì—´ ê´€ë¦¬ ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ ìœ ì €ê°€ ê³µì •í•˜ê²Œ ì¢Œì„ì„ ì˜ˆì•½í•  ìˆ˜ ìˆë„ë¡ í•˜ë©°, ì‹¤ì‹œê°„ìœ¼ë¡œ ì˜ˆì•½ ì²˜ë¦¬ ë° ê²°ì œ ê´€ë¦¬ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì§€ì›í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•˜ê³ ìˆìŠµë‹ˆë‹¤. 
ì‹œìŠ¤í…œì€ ìœ ì €ì˜ ì˜ˆì•½ ë° ê²°ì œ ìƒíƒœì— ëŒ€í•œ ê´€ë¦¬, ì”ê³  ì¶©ì „ ê¸°ëŠ¥, ê·¸ë¦¬ê³  ì˜ˆì•½ ì‹¤íŒ¨ ì‹œ ì ìœ í•œ ì¢Œì„ ì·¨ì†Œì™€ ê°™ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‚´í¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.    

- í† í° ê¸°ë°˜ ì¸ì¦ ë° ëŒ€ê¸°ì—´ ê´€ë¦¬: ìœ ì €ì˜ í† í°ì„ ë°œê¸‰í•˜ì—¬ í† í°ì˜ ìœ íš¨ ê¸°ê°„ ë™ì•ˆ ì˜ˆì•½, ì¢Œì„ ì¡°íšŒ ë“± íŠ¹ì • ê¸°ëŠ¥ì„ ì œí•œì ìœ¼ë¡œ ì œê³µ. ì´ë¥¼ í†µí•´ ë™ì‹œì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ê³ , ë¶ˆí•„ìš”í•œ ì‹œìŠ¤í…œ ìì›ì„ ì ˆì•½í•˜ë©° ê³µì •í•œ ì²˜ë¦¬ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤.
- ì˜ˆì•½ ìƒíƒœ ê´€ë¦¬ ë° ìë™ ì·¨ì†Œ: ìœ ì €ê°€ ì˜ˆì•½ í›„ ê²°ì œë¥¼ ì§„í–‰í•˜ì§€ ì•Šìœ¼ë©´, ê²°ì œ ëŒ€ê¸° ì‹œê°„ì´ ì§€ë‚˜ë©´ ìë™ìœ¼ë¡œ ì˜ˆì•½ì„ ì·¨ì†Œí•˜ê³  í•´ë‹¹ ì¢Œì„ì„ ì˜¤í”ˆí•©ë‹ˆë‹¤. ì˜ˆì•½ ì„±ê³µ í›„ ê²°ì œê¹Œì§€ì˜ ì‹œê°„ì„ ê´€ë¦¬í•˜ì—¬ ìœ ì €ì˜ ìœ íš¨í•œ í† í°ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
- ì”ê³  ì¶©ì „ ë° ê²°ì œ: í† í° ì—†ì´ë„ ì”ê³  ì¶©ì „ ë° ì˜ˆì•½ ì¡°íšŒ, ê²°ì œê°€ ê°€ëŠ¥í•˜ì§€ë§Œ, ì˜ˆì•½ í›„ ê²°ì œ ì‹œì—ëŠ” ìœ íš¨í•œ í† í°ì„ í•„ìˆ˜ë¡œ ì‚¬ìš©í•˜ì—¬ ë³´ì•ˆì„±ì„ ê°•í™”í•˜ê³  ì‹¤ì‹œê°„ ê²°ì œë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
- ìœ íš¨í•œ í† í° ë§Œë£Œ ì²˜ë¦¬: ì˜ˆì•½ í›„ ê²°ì œ ì‹œ ìœ ì €ì˜ í† í°ì€ ë§Œë£Œë©ë‹ˆë‹¤. ìœ íš¨í•œ í† í°ì„ í†µí•œ ì˜ˆì•½ í›„ ê²°ì œ ìƒíƒœê¹Œì§€ì˜ íë¦„ì„ ê´€ë¦¬í•˜ì—¬ ìœ ì €ì˜ ë°ì´í„°ë¥¼ ë³´í˜¸í•˜ê³ , ì•ˆì •ì ì¸ ì‹œìŠ¤í…œ ìš´ì˜ì„ ë³´ì¥í•©ë‹ˆë‹¤.
- í™•ì¥ì„± ë° íŠ¸ëœì­ì…˜ ê´€ë¦¬: ì‹œìŠ¤í…œì˜ í™•ì¥ì„±ì„ ê³ ë ¤í•˜ì—¬ íŠ¸ëœì­ì…˜ ê´€ë¦¬ë¥¼ í†µí•´ ë°ì´í„° ì¼ê´€ì„±ì„ ìœ ì§€í•˜ë©°, ì˜ˆì•½ ë° ê²°ì œ ì¤‘ ë°œìƒí•  ìˆ˜ ìˆëŠ” ê²½í•© ìƒíƒœë¥¼ ë°©ì§€í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. í´ë¦° ì•„í‚¤í…ì²˜ë¥¼ í†µí•´ ìœ ì§€ë³´ìˆ˜ì™€ í™•ì¥ì„± ë˜í•œ ê³ ë ¤ë˜ì—ˆìŠµë‹ˆë‹¤.
  
## ì„œë¹„ìŠ¤ ì„¤ê³„
### ìš”êµ¬ì‚¬í•­
- ìœ ì € í† í° ë°œê¸‰ API
- ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ / ì¢Œì„ API
- ì¢Œì„ ì˜ˆì•½ ìš”ì²­ API
- ì”ì•¡ ì¶©ì „ / ì¡°íšŒ API
- ê²°ì œ API
- ê° ê¸°ëŠ¥ ë° ì œì•½ì‚¬í•­ì— ëŒ€í•´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ë°˜ë“œì‹œ í•˜ë‚˜ ì´ìƒ ì‘ì„±
- ë‹¤ì¤‘ ì„œë²„, ë™ì‹œì„± ì´ìŠˆë¥¼ ê³ ë ¤
- ëŒ€ê¸°ì—´ ê°œë…ì„ ê³ ë ¤í•´ êµ¬í˜„
### [Milestone](https://github.com/users/JoYuKang/projects/5)
### [Sequence Diagram](https://github.com/JoYuKang/Concert_Reservation/blob/docs/docs/%EC%8B%9C%ED%80%80%EC%8A%A4%20%EB%8B%A4%EC%9D%B4%EC%96%B4%EA%B7%B8%EB%9E%A8.md)
### [ERD](https://github.com/JoYuKang/Concert_Reservation/blob/main/docs/ERD.md)
### [API ëª…ì„¸ì„œ](https://github.com/JoYuKang/Concert_Reservation/blob/docs/docs/API%20%EB%AA%85%EC%84%B8%EC%84%9C.md)
### [í”Œë¡œìš°ì°¨íŠ¸](https://github.com/JoYuKang/Concert_Reservation/blob/docs/docs/%ED%94%8C%EB%A1%9C%EC%9A%B0%20%EC%B0%A8%ED%8A%B8.md)
### [ì½˜ì„œíŠ¸ ì¡°íšŒ ì„±ëŠ¥ ê°œì„  ë³´ê³ ì„œ](#ì½˜ì„œíŠ¸-ì¡°íšŒ-ì„±ëŠ¥-ê°œì„ -ë³´ê³ ì„œ)
## í˜í‚¤ì§€ êµ¬ì¡°
```
src/
â”œâ”€â”€ support/
â”‚   â”œâ”€â”€ common/ 
â”‚          â””â”€â”€ entity/                 # ê³µí†µ ì—”í‹°í‹°
â”‚   â”œâ”€â”€ exception/                     # ì˜ˆì™¸ ê´€ë¦¬                  
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ jpa/
â”‚   â”‚   â”œâ”€â”€ web/
â”‚   â”œâ”€â”€ interceptor
â”‚   â”œâ”€â”€    http/                       # ìœ í‹¸ë¦¬í‹°
â”‚            â””â”€ CommonResponse.java 
â”œâ”€â”€ member/                   
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ Member.java.                 # Member ì—”í‹°í‹°
â”‚   â”‚   â”œâ”€â”€ memberService.java.          # Member ì„œë¹„ìŠ¤ 
â”‚   â”‚   â”œâ”€â”€ MemberRepository.java.       # Member Interface   
â”‚   â”œâ”€â”€ application
â”‚   â”‚   â”œâ”€â”€ facade
â”‚   â”‚   â”œâ”€â”€ Service
â”‚   â”‚   â”‚   â”œâ”€â”€ memberService.java.          # Member ì„œë¹„ìŠ¤ êµ¬í˜„ì²´
â”‚   â”œâ”€â”€ interfaces/ 
â”‚   â”‚   â”œâ”€â”€ MemberController.java
â”‚   â”‚   â”œâ”€â”€ dto
â”‚   â”‚   â”‚   â”œâ”€â”€ request
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MemberRequest.java
â”‚   â”‚   â”‚   â”œâ”€â”€ response
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MemberResponse.java
â””â”€â”€â”€â”€â”€â”€ infrastructure/
        â””â”€â”€ MemberJPARepository.java

```
## API Swagger

### ìœ ì €ì˜ í† í° ë°œê¸‰ API
<img width="1439" alt="image" src="https://github.com/user-attachments/assets/20cc7da3-05a7-43b5-a2bc-0ba29f65d28d" />

### ìœ ì €ì˜ í† í° ì¡°íšŒ API
<img width="1435" alt="image" src="https://github.com/user-attachments/assets/b692dee9-7e41-4b11-9308-1132bcb4f4c0" />

### ìœ ì €ì˜ ì¡°íšŒ API
![image](https://github.com/user-attachments/assets/1b422a75-f4d9-42f2-8101-f4b3d2f9701d)

### ìœ ì €ì˜ ì¶©ì „ ìš”ì²­ API
![image](https://github.com/user-attachments/assets/a2d9a3f5-7319-48bb-a47c-546e5f02e83f)

### ìœ ì €ì˜ ì˜ˆì•½ ìš”ì²­ API
![image](https://github.com/user-attachments/assets/0fe754f4-9ed5-4207-a2bf-554f782ad82a)

### ìœ ì €ì˜ ì˜ˆì•½ ê²°ì œ ìš”ì²­ API
![image](https://github.com/user-attachments/assets/bf359647-3607-4e0c-9e09-3aa62790b14a)

### ìœ ì €ì˜ ì˜ˆì•½ ë‚´ì—­ ì¡°íšŒ API
![image](https://github.com/user-attachments/assets/bf301d58-2ac5-418e-ab90-aaf46a4b7d72)

### ì½˜ì„œíŠ¸ ì´ë¦„ ì¡°íšŒ API
![image](https://github.com/user-attachments/assets/d6222461-fbdc-4eb6-840c-a834b08913d8)

### ì½˜ì„œíŠ¸ ì¼ì ì¡°íšŒ API
![image](https://github.com/user-attachments/assets/c2acf4ca-d89a-471d-bf20-1e28d7a1350e)

### ì½˜ì„œíŠ¸ ì¢Œì„ ì¡°íšŒ API
![image](https://github.com/user-attachments/assets/2b68a2f1-2a67-4026-807f-2c49d529d42e)


## ë™ì‹œì„± ë¬¸ì œëŠ” ì™œ ë°œìƒí•˜ëŠ”ê°€?

ì»´í“¨í„°ëŠ” ë§ˆì¹˜ ì—¬ëŸ¬ ê°€ì§€ ì¼ì„ ë™ì‹œì— ì²˜ë¦¬í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, ì‹¤ì œë¡œëŠ” í•œ ë²ˆì— í•˜ë‚˜ì˜ ì‘ì—…ì”© ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ ë™ì¼í•œ ë°ì´í„°ì— ëŒ€í•´ ì—¬ëŸ¬ íŠ¸ëœì­ì…˜ì´ ë™ì‹œì— ì ‘ê·¼í•˜ê±°ë‚˜ ìˆ˜ì •í•˜ë ¤ê³  ì‹œë„í•˜ë©´, ë°ì´í„°ì˜ ì •í•©ì„±ì— ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ë‘ íŠ¸ëœì­ì…˜ì´ ë™ì‹œì— ê°™ì€ ë°ì´í„°ë¥¼ ì½ê³ , ê°ê° ìˆ˜ì •í•œ ë’¤ ì €ì¥í•˜ë ¤ê³  í•˜ë©´, í•œìª½ì˜ ìˆ˜ì • ë‚´ìš©ì´ ë®ì–´ì”Œì›Œì§€ê±°ë‚˜ ì˜ë„ì¹˜ ì•Šì€ ê°’ì´ ì €ì¥ë  ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë™ì‹œì„± ë¬¸ì œëŠ” ë°ì´í„° ì¼ê´€ì„±ì„ ìœ„í˜‘í•˜ë©° ì‹œìŠ¤í…œì˜ ì•ˆì •ì„±ê³¼ ì‹ ë¢°ì„±ì„ ì €í•˜ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ì´ìŠˆë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë‚™ê´€ì  ë½, ë¹„ê´€ì  ë½, ë ˆë””ìŠ¤ ë“± ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ë™ì‹œì„±ì„ í•´ê²°í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê°ê°ì˜ ë°©ë²•ì€ ì¥ë‹¨ì ì´ ìˆê¸° ë•Œë¬¸ì— ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ì— ë§ì¶° ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ë©´ì„œë„ ì„±ëŠ¥ì„ ê³ ë ¤í•œ ì„ íƒì„ í•´ì•¼ í•©ë‹ˆë‹¤.

---

## ë‚™ê´€ì  ë½ê³¼ ë¹„ê´€ì  ë½ ë¹„êµ

| íŠ¹ì§•           | ë‚™ê´€ì  ë½ (Optimistic Lock)                                                    | ë¹„ê´€ì  ë½ (Pessimistic Lock)                                                  |
|----------------|-------------------------------------------------------------------------------|-------------------------------------------------------------------------------|
| ê°œë…           | ë°ì´í„° ì½ì„ ë•Œ ë½ì„ ê±¸ì§€ ì•Šìœ¼ë©°, ë³€ê²½ ì‹œ ì¶©ëŒ ì—¬ë¶€ í™•ì¸ í›„ ì¬ì‹œë„ ë˜ëŠ” ì‹¤íŒ¨ ì²˜ë¦¬ | ë°ì´í„°ë¥¼ ì½ì„ ë•Œ ë°”ë¡œ ë½ì„ ê±¸ì–´ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ë°ì´í„°ì— ì ‘ê·¼í•˜ì§€ ëª»í•˜ê²Œ í•¨     |
| ì¶©ëŒ ì²˜ë¦¬ ë°©ì‹ | ì¶©ëŒ ë°œìƒ ì‹œ ì˜ˆì™¸ë¥¼ ë˜ì§€ê³ , ì¬ì‹œë„ ë¡œì§ì´ë‚˜ ë‹¤ë¥¸ ì²˜ë¦¬ ë¡œì§ìœ¼ë¡œ ë¬¸ì œë¥¼ í•´ê²°         | ì¶©ëŒ ë°©ì§€ë¥¼ ìœ„í•´ íŠ¸ëœì­ì…˜ ì¢…ë£Œ ì‹œê¹Œì§€ ë°ì´í„° ë½ ìœ ì§€                         |
| ì‚¬ìš© ìƒí™©      | ì¶©ëŒì´ ë“œë¬¼ê³  ë‹¤ì¤‘ ì‚¬ìš©ì í™˜ê²½ì—ì„œ ë†’ì€ ë™ì‹œì„± ë³´ì¥ì´ í•„ìš”í•œ ê²½ìš°               | ì¶©ëŒ ê°€ëŠ¥ì„±ì´ ë†’ê³  ë°ì´í„° ì •í•©ì„±ì´ ì¤‘ìš”í•œ ê²½ìš°                               |
| ì„±ëŠ¥           | ë°ì´í„° ì¶©ëŒì´ ì ì€ ê²½ìš° ì„±ëŠ¥ ìš°ìˆ˜                                              | ë½ìœ¼ë¡œ ì¸í•œ ëŒ€ê¸° ì‹œê°„ ì¦ê°€ë¡œ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ëŸ‰ ê°ì†Œ                            |
| ë½ ë°©ì‹        | DB ë²„ì „ í•„ë“œ(@Version)ë‚˜ íƒ€ì„ìŠ¤íƒ¬í”„ í™œìš©                                       | DBì˜ S-Lock ë˜ëŠ” X-Lock í™œìš©                                                |
| ì¥ì            | ë†’ì€ ë™ì‹œì„± ì²˜ë¦¬ ê°€ëŠ¥, ì˜¤ë²„í—¤ë“œ ê°ì†Œ                                           | ë°ì´í„° ì •í•©ì„± ë³´ì¥                                                           |
| ë‹¨ì            | ì¶©ëŒì´ ë¹ˆë²ˆí•˜ë©´ ì¬ì‹œë„ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜                                        | ëŒ€ê¸° ì‹œê°„ ì¦ê°€, ë°ë“œë½(Deadlock) ìœ„í—˜                                        |

---

## ë¹„ê´€ì  ë½ (S-Lock, X-Lock) ë¹„êµ

| íŠ¹ì§•           | Shared Lock (S-Lock)                                              | Exclusive Lock (X-Lock)                                                     |
|----------------|-------------------------------------------------------------------|----------------------------------------------------------------------------|
| ê°œë…           | ë°ì´í„°ë¥¼ ì½ê¸° ì‘ì—…ì—ë§Œ ì‚¬ìš©í•˜ë„ë¡ í—ˆìš©                              | ë°ì´í„°ë¥¼ ì½ê¸° ë° ìˆ˜ì • ì‘ì—…ì— ëŒ€í•´ ë…ì ì ìœ¼ë¡œ ì‚¬ìš©                            |
| í—ˆìš©ë˜ëŠ” ì‘ì—…  | ì½ê¸° ì‘ì—… ê°€ëŠ¥, ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ë„ ë™ì¼ ë°ì´í„° ì½ê¸° ê°€ëŠ¥               | ì½ê¸° ë° ì“°ê¸° ì‘ì—… ê°€ëŠ¥, ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì˜ ëª¨ë“  ì‘ì—… ì°¨ë‹¨                       |
| ë™ì‹œì„± ì§€ì›    | ì½ê¸° ì‘ì—… ê°„ ë†’ì€ ë™ì‹œì„± ì§€ì›                                      | íŠ¸ëœì­ì…˜ì´ ë°ì´í„° ë…ì  ì ‘ê·¼, ë™ì‹œì„± ì œí•œ                                     |
| ëª©ì            | ì½ê¸° ì‘ì—… ì¶©ëŒ ë°©ì§€ ë° ë°ì´í„° ë³€ê²½ ë°©ì§€                             | ë°ì´í„° ì½ê¸°/ì“°ê¸° ì¶©ëŒ ë°©ì§€ ë° ì •í•©ì„± ë³´ì¥                                    |
| êµì°© ìƒíƒœ ê°€ëŠ¥ì„± | S-Lockê³¼ X-Lock í˜¼í•© ì‚¬ìš© ì‹œ ë°œìƒ ê°€ëŠ¥                              | X-Lock ê°„ ì¶©ëŒë¡œ Deadlock ë°œìƒ ê°€ëŠ¥                                         |
| ì„±ëŠ¥           | ì„±ëŠ¥ì— í° ì˜í–¥ ì—†ìŒ                                               | ë™ì‹œì„± ë‚®ì•„ì ¸ ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥                                                |

---
## ì½˜ì„œíŠ¸ì—ì„œ ë°œìƒí•˜ëŠ” ë™ì‹œì„± ì´ìŠˆ
ì½˜ì„œíŠ¸ì—ì„œ ë°œìƒí•˜ëŠ” ëŒ€í‘œì ì¸ ë™ì‹œì„± ì´ìŠˆëŠ” ì½˜ì„œíŠ¸ì˜ ì¢Œì„ì„ ì—¬ëŸ¬ëª…ì˜ ìœ ì €ê°€ ë™ì‹œì— ì—ì•½í•˜ëŠ” ìƒí™©ì—ì„œ ì£¼ë¡œ ë°œìƒí•˜ì—¬ ë‹¤ìŒ ìƒí™©ì—ì„œì˜ ë¹„ê´€ì  ë½ê³¼ ë‚™ê´€ì  ë½ì˜ ì ìš© ì‹œ ì–´ë–¤ ì„±ëŠ¥ì˜ ì°¨ì´ê°€ ìˆëŠ”ì§€ ë¹„êµí•´ ë³´ê² ìŠµë‹ˆë‹¤. 

## ì½˜ì„œíŠ¸ ì¢Œì„ ì˜ˆì•½ ë¡œì§ ë¹„ê´€ì  ë½ (X-Lock) ì˜ˆì œ

```java
@Service
@RequiredArgsConstructor
public class ReservationFacade {

    private final ReservationService reservationService;
    private final MemberService memberService;
    private final ConcertService concertService;
    private final SeatService seatService;

    // ì¢Œì„ ì˜ˆì•½
    @Transactional
    public Reservation createReservation(ReservationRequest request) {
        // member í™•ì¸
        Member member = memberService.findById(request.getMemberId());

        // concert í™•ì¸
        Concert concert = concertService.getById(request.getConcertId());

        // íŒë§¤ì¤‘ì¸ Seat í™•ì¸ ë¹„ê´€ì  ë½ ì ìš©
        List<Seat> seats = seatService.searchSeatWithLock(request.getConcertId(), request.getSeatNumbers());

        // ì˜ˆì•½ ê²°ì œëŒ€ê¸° ì €ì¥
        Reservation reservation = new Reservation(member, concert, seats);

        return reservationService.save(reservation);
    }
}
```

### ì¢Œì„ ì¡°íšŒ ì‹œ ë½ ì ìš©

```java
@Override
public List<Seat> searchSeatWithLock(Long concertId, List<Integer> seatNumbers) {
    List<Seat> selectedSeat = seatJpaRepository.findByConcertIdAndPositionWithLock(concertId, seatNumbers);

    for (Seat seat : selectedSeat) {
        if (seat.getStatus() == SeatStatus.SOLD_OUT) {
            throw new SeatInvalidException(ErrorMessages.SEAT_INVALID);
        }
        seat.reserve();
    }

    return seatJpaRepository.saveAll(selectedSeat);
}

@Lock(LockModeType.PESSIMISTIC_WRITE)
@Query("SELECT s FROM Seat s WHERE s.concert.id = :concertId AND s.seatNumber IN :positions")
List<Seat> findByConcertIdAndPositionWithLock(@Param("concertId") Long concertId, @Param("positions") List<Integer> positions);
```

---

## ì½˜ì„œíŠ¸ ì¢Œì„ ì˜ˆì•½ ë¡œì§ ë‚™ê´€ì  ë½ (S-Lock) ì˜ˆì œ

```java
@Service
@RequiredArgsConstructor
public class ReservationFacade {

    private final ReservationService reservationService;
    private final MemberService memberService;
    private final ConcertService concertService;
    private final SeatService seatService;

    // ì¢Œì„ ì˜ˆì•½
    @Transactional
    public Reservation createReservation(ReservationRequest request) {
        // member í™•ì¸
        Member member = memberService.findById(request.getMemberId());

        // concert í™•ì¸
        Concert concert = concertService.getById(request.getConcertId());

        // íŒë§¤ì¤‘ì¸ Seat í™•ì¸
        List<Seat> seats = seatService.searchSeat(request.getConcertId(), request.getSeatNumbers());

        // ì˜ˆì•½ ê²°ì œëŒ€ê¸° ì €ì¥
        Reservation reservation = new Reservation(member, concert, seats);

        return reservationService.save(reservation);
    }
}
```

### ë°ì´í„° ì—…ë°ì´íŠ¸ì— @Version ì¶”ê°€ ë° ì˜ˆì™¸ ì²˜ë¦¬

ë‚™ê´€ì ë½ì€ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹œ @Versionì„ í™•ì¸í•˜ì—¬ ë™ì‹œì„±ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
```java
public class Seat {

    @Id
    @Column(name = "seat_id")
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(cascade = CascadeType.REMOVE)
    @JoinColumn(name = "concert_id", nullable = false)
    private Concert concert;

    @Column(name = "position")
    private Integer seatNumber;

    private Integer amount;

    @Enumerated(EnumType.STRING)
    private SeatStatus status; // AVAILABLE, SOLD_OUT

    @Version
    @Column(nullable = false)
    private Integer version = 0; // JPAê°€ ìë™ìœ¼ë¡œ ê´€ë¦¬í•  í•„ë“œ
}

```
ë‚™ê´€ì ë½ ì¢Œì„ í™•ì¸ ë¡œì§
```java
@Transactional
@Override
public List<Seat> searchSeat(Long concertId, List<Integer> seatNumbers) {
    try {
        // ìš”ì²­ëœ ì¢Œì„ ê°€ì ¸ì˜¤ê¸°
        List<Seat> selectedSeat = seatJpaRepository.findByConcertIdAndPosition(concertId, seatNumbers);
        // ì¢Œì„ ìœ íš¨ì„± í™•ì¸
        for (Seat seat : selectedSeat) {
            if (seat.getStatus() == SeatStatus.SOLD_OUT) {
                throw new SeatInvalidException(ErrorMessages.SEAT_INVALID);
            }
            seat.reserve();
        }
        return seatJpaRepository.saveAll(selectedSeat);
    } catch (ObjectOptimisticLockingFailureException ex) {
        throw new SeatInvalidException(ErrorMessages.SEAT_NOT_FOUND);
    }
}
```

SeatInvalidExceptionìœ¼ë¡œ ì¢Œì„ ì˜ˆì™¸ë¥¼ ê´€ë¦¬í•˜ë©°, ì¢Œì„ì— ëŒ€í•œ ì˜¤ë¥˜ ìƒì„¸ ë‚´ì—­ì„ SEAT_INVALIDê³¼ SEAT_NOT_FOUNDì˜ ë¬¸êµ¬ë¥¼ í†µí•´ ì–´ë–¤ ì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ë¹„ê´€ì  ë½ vs ë‚™ê´€ì  ë½ ì„±ëŠ¥ ë¹„êµ

### ë¹„ê´€ì  ë½ ì†Œìš” ì‹œê°„
```
INFO 93109 --- [main] k.h.b.s.r.a.f.ReservationFacadeTest : Member 2 request time: 86 ms
INFO 93109 --- [main] k.h.b.s.r.a.f.ReservationFacadeTest : Member 3 request time: 92 ms
INFO 93109 --- [main] k.h.b.s.r.a.f.ReservationFacadeTest : Member 4 request time: 86 ms
INFO 93109 --- [main] k.h.b.s.r.a.f.ReservationFacadeTest : Member 5 request time: 75 ms
INFO 93109 --- [main] k.h.b.s.r.a.f.ReservationFacadeTest : Member 6 request time: 103 ms
INFO 93109 --- [main] k.h.b.s.r.a.f.ReservationFacadeTest : Member 7 request time: 103 ms
INFO 93109 --- [main] k.h.b.s.r.a.f.ReservationFacadeTest : Total execution time: 104 ms
```

### ë‚™ê´€ì  ë½ ì†Œìš” ì‹œê°„
```
INFO 8535 --- [main] k.h.b.s.r.a.f.ReservationFacadeTest : Member 2 request time: 60 ms
INFO 8535 --- [main] k.h.b.s.r.a.f.ReservationFacadeTest : Member 3 request time: 67 ms
INFO 8535 --- [main] k.h.b.s.r.a.f.ReservationFacadeTest : Member 4 request time: 66 ms
INFO 8535 --- [main] k.h.b.s.r.a.f.ReservationFacadeTest : Member 5 request time: 71 ms
INFO 8535 --- [main] k.h.b.s.r.a.f.ReservationFacadeTest : Member 6 request time: 71 ms
INFO 8535 --- [main] k.h.b.s.r.a.f.ReservationFacadeTest : Member 7 request time: 66 ms
INFO 8535 --- [main] k.h.b.s.r.a.f.ReservationFacadeTest : Total execution time: 72 ms
```

### ë‚™ê´€ì  ë½ìœ¼ë¡œ ë³€ê²½í•œ ì´ìœ 

ë¹„ê´€ì  ë½ì—ì„œ ë‚™ê´€ì  ë½ìœ¼ë¡œ ë³€ê²½í•œ ì£¼ëœ ì´ìœ ëŠ” ë™ì‹œì„± ì²˜ë¦¬ì—ì„œ ì„±ëŠ¥ì„ ê°œì„ í•˜ê³  ì‚¬ìš©ì ê²½í—˜ì„ í–¥ìƒí•˜ê¸° ìœ„í•´ì„œì…ë‹ˆë‹¤. ê¸°ì¡´ ë¹„ê´€ì  ë½ ë°©ì‹ì€ íŠ¸ëœì­ì…˜ì´ ìì›ì„ ì ìœ í•˜ëŠ” ë™ì•ˆ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ëŒ€ê¸°í•´ì•¼ í–ˆê¸° ë•Œë¬¸ì— ëŒ€ëŸ‰ì˜ ë™ì‹œ ìš”ì²­ì´ ë°œìƒí•  ê²½ìš° ì„±ëŠ¥ ì €í•˜ì™€ ì²˜ë¦¬ ì†ë„ ê°ì†Œ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë°˜ë©´, ë‚™ê´€ì  ë½ì€ ìì› ì ìœ ë¥¼ ìµœì†Œí™”í•˜ê³  ë°ì´í„° ì¶©ëŒì´ ì‹¤ì œë¡œ ë°œìƒí–ˆì„ ë•Œë§Œ ì´ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì„¤ê³„ë˜ì–´ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‚™ê´€ì  ë½ êµ¬í˜„ìœ¼ë¡œ ì²« ì‹œë„ë§Œì„ í—ˆìš©í•˜ê³  ë‹¤ë¥¸ ë™ì‹œì„± ì´ìŠˆê°€ ë°œìƒ ì‹œ ë” ì´ìƒ ì¬ì‹œë„ë¥¼ ì§„í–‰í•˜ì§€ ì•Šê³  ì˜ˆì™¸ë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬í•©ë‹ˆë‹¤. ì´ëŸ° ë°©ë²•ìœ¼ë¡œ ì‹œìŠ¤í…œ ìì›ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•˜ë©´ì„œ ë™ì‹œì— ì¶©ëŒ ê´€ë¦¬ ë¡œì§ì„ ê°„ì†Œí™”í–ˆìŠµë‹ˆë‹¤.

---

# Redis ìºì‹± ì ìš© ì „í›„ ì„±ëŠ¥ ë¹„êµ

## ëª©ì 
Redis ìºì‹±ì„ ì ìš©í•˜ì—¬ ì¡°íšŒ ì„±ëŠ¥ì„ ê°œì„ í•˜ê³ , ìºì‹±ì˜ íš¨ê³¼ë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤.

### í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ë©”ì„œë“œ (ì½˜ì„œíŠ¸ ë©”ì¸ í˜ì´ì§€ ì¼ì ì¡°íšŒ)
```java
@Override
@Cacheable(value = "concerts", key = "'concert:' + #date")
public List<Concert> findByDate(LocalDate date) {
    return concertJpaRepository.findAllByClosestToToday(date);
}
```

``` java
// ì£¼ì–´ì§„ ë‚ ì§œ ì´í›„ì˜ ì½˜ì„œíŠ¸ë¥¼ ì¡°íšŒí•˜ê³ , í•´ë‹¹ ë‚ ê³¼ ê°€ê¹Œìš´ ë‚ ì§œë¶€í„° ë©€ì–´ì§€ëŠ” ìˆœìœ¼ë¡œ ì •ë ¬
@Query("SELECT c FROM Concert c WHERE c.concertDate >= :date ORDER BY c.concertDate ASC LIMIT 100")
List<Concert> findAllByClosestToToday(@Param("date") LocalDate date);
```

### í…ŒìŠ¤íŠ¸ í™˜ê²½
- **ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒ:** ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§ì ‘ ë°ì´í„°ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
- **Redis ìºì‹œ ì¡°íšŒ:** Redisì— ìºì‹œëœ ë°ì´í„°ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
- **ì´ ìƒ˜í”Œ ìˆ˜**: 10,000 (ê° 5,000ê°œì”©)
- **í…ŒìŠ¤íŠ¸ ì§€í‘œ**: í‰ê·  ì‘ë‹µ ì‹œê°„, ìµœì†Œ/ìµœëŒ€ ì‘ë‹µ ì‹œê°„, í‘œì¤€ í¸ì°¨, ì—ëŸ¬ìœ¨, ì²˜ë¦¬ëŸ‰, ë„¤íŠ¸ì›Œí¬ ë°ì´í„° ì „ì†¡ëŸ‰

### í…ŒìŠ¤íŠ¸ ê²°ê³¼
| **í•­ëª©**              | **Cache ì¡°íšŒ**   | **DB ì¡°íšŒ** |
|---------------------|--------------|-----------|
| **í‰ê·  ì‘ë‹µ ì‹œê°„**        | 822 ms       | 1561 ms   |
| **ìµœì†Œ ì‘ë‹µ ì‹œê°„**        | 3 ms         | 43 ms     |
| **ìµœëŒ€ ì‘ë‹µ ì‹œê°„**        | 2052 ms      | 2479 ms   |
| **í‘œì¤€ í¸ì°¨**           | 318.62 ms    | 344.61 ms |
| **ì—ëŸ¬ìœ¨**             | 0.06%        | 0.00%     |
| **ì²˜ë¦¬ëŸ‰**             | 981.0/sec    | 513.8/sec |
| **Received KB/sec** | 5102.45 KB   | 2673.20 KB |
| **Sent KB/sec**     | 179.03 KB    | 93.82 KB  |
| **í‰ê·  ì „ì†¡ ë°”ì´íŠ¸**       | 5326.3 bytes | 5328.0 bytes |

1. **ì„±ëŠ¥**
    - Cacheë¥¼ ì‚¬ìš©í•œ ì¡°íšŒê°€ DBë§Œì„ ì‚¬ìš©í•œ ì¡°íšŒë³´ë‹¤ ì•½ **47% ë” ë¹ ë¥¸** í‰ê·  ì‘ë‹µ ì‹œê°„ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤.

2. **ì²˜ë¦¬ëŸ‰**
    - Cacheë¥¼ ì‚¬ìš©í•œ ì¡°íšŒì˜ ì²˜ë¦¬ëŸ‰(981.0/sec)ì´ DBë§Œì„ ì‚¬ìš©í•œ ì¡°íšŒì˜ ì²˜ë¦¬ëŸ‰(513.8/sec)ë³´ë‹¤ ì•½ **90% ë” ë†’ì•˜ìŠµë‹ˆë‹¤.**

3. **ë„¤íŠ¸ì›Œí¬ ë°ì´í„° ì „ì†¡ëŸ‰**
    - Cacheë¥¼ ì‚¬ìš©í•œ ì¡°íšŒëŠ” DBë§Œì„ ì‚¬ìš©í•œ ì¡°íšŒë³´ë‹¤ ì•½ **91% ë§ì€ Received KB/sec**ë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤.

4. **ì•ˆì •ì„±**
    - DBë§Œì„ ì‚¬ìš©í•œ ì¡°íšŒì˜ ì—ëŸ¬ëŠ” ì—†ì—ˆê³  Cacheë¥¼ ì‚¬ìš©í•œ ì¡°íšŒì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí–ˆì§€ë§Œ 0.06%ë¡œ ì‹¬ê°í•œ ìˆ˜ì¤€ì€ ì•„ë‹ˆì˜€ìŠµë‹ˆë‹¤.

5. **ì‘ë‹µ ì‹œê°„ ë³€ë™ì„± (í‘œì¤€ í¸ì°¨)**
    - Cacheë¥¼ ì‚¬ìš©í•œ ì¡°íšŒì™€ DBë§Œì„ ì‚¬ìš©í•œ ì¡°íšŒ ëª¨ë‘ ë¹„ìŠ·í•œ ìˆ˜ì¤€ì˜ ë³€ë™ì„±ì„ ë³´ì˜€ìŠµë‹ˆë‹¤.



## ìºì‹±ì„ ì ìš©í•œ ì´ìœ 
### ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
**í† í° ë°œê¸‰ ìš”ì²­ > ëŒ€ê¸°ì—´ ì§„ì… > (í´ë§) > ëŒ€ê¸°ì—´ í†µê³¼ > ê¸°ë³¸ ì½˜ì„œíŠ¸ ëª©ë¡ ì¡°íšŒ > ì½˜ì„œíŠ¸ ì¢Œì„ ì¡°íšŒ > ì˜ˆì•½ > ê²°ì œ > í† í° ë§Œë£Œì²˜ë¦¬**

ì´ ê³¼ì •ì—ì„œ **ê¸°ë³¸ ì½˜ì„œíŠ¸ ëª©ë¡ ì¡°íšŒ**ëŠ” ë°ì´í„° ì–‘ì´ ë§ê³ , ì—¬ëŸ¬ ì‚¬ìš©ìì—ê²Œ ë™ì¼í•œ ìš”ì²­ì´ ë°˜ë³µë  ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.
- DB ë¶€í•˜ë¥¼ ì¤„ì´ê¸° ìœ„í•´ **í˜ì´ì§• ì²˜ë¦¬**ë¥¼ ì ìš©í•˜ë”ë¼ë„ ë°˜ë³µ ìš”ì²­ì´ ë§ì•„ ë¶€í•˜ ê°€ëŠ¥ì„±ì´ ì¡´ì¬í•©ë‹ˆë‹¤.
- ì½˜ì„œíŠ¸ ì •ë³´ëŠ” ìì£¼ ë³€ê²½ë˜ì§€ ì•Šì•„ ë™ì¼í•œ ë°ì´í„°ê°€ ì¡°íšŒë  ê°€ëŠ¥ì„±ì´ ë†’ìœ¼ë¯€ë¡œ, ìºì‹±ì´ ì í•©í•©ë‹ˆë‹¤.

## ì„±ëŠ¥ ê°œì„ 
### ë°ì´í„°ë² ì´ìŠ¤ ë¶€í•˜ ê°ì†Œ
- ë°ì´í„°ë² ì´ìŠ¤ëŠ” ë””ìŠ¤í¬ ê¸°ë°˜ ì €ì¥ì†Œë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œ I/O ì‘ì—…ì´ ë°œìƒí•˜ì§€ë§Œ RedisëŠ” ë©”ëª¨ë¦¬ ê¸°ë°˜ ì €ì¥ì†Œë¡œ ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì—ì„œ ì§ì ‘ ì¡°íšŒí•˜ë¯€ë¡œ ì†ë„ê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ë¹„í•´ ë¹ ë¦…ë‹ˆë‹¤.

### ë°˜ë³µì ì¸ ì¡°íšŒ ìµœì í™”
- ë™ì¼í•œ ìš”ì²­ì— ëŒ€í•´ DB ì¡°íšŒë¥¼ ë°˜ë³µí•˜ì§€ ì•Šê³  ìºì‹œì—ì„œ ë¹ ë¥´ê²Œ ë°ì´í„°ë¥¼ ì œê³µ ê°€ëŠ¥

### ì‘ë‹µ ì‹œê°„ ë‹¨ì¶•
- ìºì‹œë¥¼ ì‚¬ìš©í•˜ë©´ ë°ì´í„° ì¡°íšŒ ì‹œê°„ ë‹¨ì¶•


## ìºì‹± ì „ëµ

### [ìºì‹œ ì •ë¦¬](https://yukang-laboratory.tistory.com/55)

### 1. ìºì‹œ í‚¤ ì„¤ê³„
- **í‚¤ í˜•ì‹:** `concert:2025-02-04`
- **ì„¤ëª…:** ë‚ ì§œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìºì‹œ í‚¤ë¥¼ ìƒì„±í•˜ì—¬, íŠ¹ì • ë‚ ì§œì˜ ì½˜ì„œíŠ¸ ì •ë³´ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.

### 2. TTL ì„¤ì •
- **TTL:** 10ë¶„
- **ì„¤ëª…:** ìºì‹œëœ ë°ì´í„°ëŠ” 10ë¶„ í›„ì— ìë™ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤. ë°ì´í„°ì˜ ìµœì‹ ì„±ì„ ë³´ì¥í•˜ê³ , ì˜¤ë˜ëœ ë°ì´í„°ê°€ ìºì‹œì— ë‚¨ì•„ ìˆëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤.

## ê²°ë¡ 
### **ìºì‹œ í™œìš©ì˜ ì¤‘ìš”ì„±**
ì´ë²ˆ ì„±ëŠ¥ ë¹„êµ ê²°ê³¼ Redis ìºì‹œ ì¡°íšŒ ì†ë„ê°€ DB ì¡°íšŒë³´ë‹¤ í›¨ì”¬ ë¹ ë¥´ë©° ìºì‹œëŠ” ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ì €ì¥í•´ ì¡°íšŒ ì„±ëŠ¥ì„ í¬ê²Œ ê°œì„ í•©ë‹ˆë‹¤. íŠ¸ë˜í”½ì´ ë§ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” Redisë¥¼ í™œìš©í•´ ë°ì´í„°ë² ì´ìŠ¤ ë¶€í•˜ë¥¼ ë‚®ì¶”ê³  ì‘ë‹µ ì†ë„ë¥¼ ë†’ì´ëŠ” ê²ƒì´ íš¨ê³¼ì ì…ë‹ˆë‹¤. ìì£¼ ì¡°íšŒë˜ëŠ” ë°ì´í„°ì— ìºì‹œë¥¼ ì ìš©í•˜ë©´ ì‹œìŠ¤í…œ ì„±ëŠ¥ì´ í–¥ìƒë˜ë©° DB ë¶€í•˜ ì—†ì´ ë¹ ë¥¸ ì‘ë‹µì„ ì œê³µí•  ìˆ˜ ìˆë‹¤ëŠ” ì ì„ ë°°ì› ìŠµë‹ˆë‹¤.

## í–¥í›„ ê°œì„  ë°©í–¥
### 1. ìºì‹œ ì ì¤‘ë¥  ëª¨ë‹ˆí„°ë§
- ìºì‹œ ì ì¤‘ë¥ ì„ ëª¨ë‹ˆí„°ë§í•˜ì—¬ ìºì‹œì˜ íš¨ìœ¨ì„±ì„ í‰ê°€í•©ë‹ˆë‹¤.
- ì ì¤‘ë¥ ì´ ë‚®ë‹¤ë©´ **ìºì‹œ í‚¤ ì„¤ê³„ë‚˜ TTLì„ ì¡°ì •**í•©ë‹ˆë‹¤.

### 2. ë¶„ì‚° ìºì‹œ ì ìš©
- ëŒ€ê·œëª¨ íŠ¸ë˜í”½ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ **Redis í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•˜ì—¬ ë¶„ì‚° ìºì‹œë¥¼ ì ìš©**í•©ë‹ˆë‹¤.

### 3. ìºì‹œ ë¬´íš¨í™”
- **ì „ëµ:** ì½˜ì„œíŠ¸ ì •ë³´ê°€ ë³€ê²½ë  ë•Œ ìºì‹œë¥¼ ë¬´íš¨í™”í•©ë‹ˆë‹¤.
- **ì˜ˆì‹œ:** ìƒˆë¡œìš´ ì½˜ì„œíŠ¸ê°€ ì¶”ê°€ë˜ê±°ë‚˜ ê¸°ì¡´ ì½˜ì„œíŠ¸ê°€ ìˆ˜ì •ë  ë•Œ, í•´ë‹¹ ë‚ ì§œì˜ ìºì‹œë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.


---

## **í† í° ìš”ì²­ í˜¸ì¶œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„**

### **ğŸ“Š í…ŒìŠ¤íŠ¸ ì„¤ì •**
- **Ramp-Up ê¸°ê°„:** 60ì´ˆ
- **Loop Count:** 1
- **Thread ìˆ˜(ì‚¬ìš©ì ìˆ˜):** 4,000ëª… (ì¶”ì •)
- **í…ŒìŠ¤íŠ¸ ëª©ì :** ì´ˆë‹¹ ì–¼ë§ˆë‚˜ ë§ì€ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸
- **ì´ˆê¸° í…ŒìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©ì ìˆ˜ë¥¼ 10,000ëª…ìœ¼ë¡œ ì„¤ì •í–ˆìœ¼ë‚˜, JMeter ì„œë²„ê°€ ë©ˆì¶° 4,000ëª…ìœ¼ë¡œ ì¤„ì—¬ì„œ ì§„í–‰**



### **í† í° ìš”ì²­ í˜¸ì¶œ ì£¼ìš” ê²°ê³¼**
| í•­ëª©                        | ê°’            | ì„¤ëª…                                         |
|-----------------------------|---------------|----------------------------------------------|
| **ìš”ì²­ ê±´ìˆ˜**               | 4,000         | ì´ ìš”ì²­ ìˆ˜ (4,000ê±´ ìš”ì²­ ìˆ˜í–‰)                |
| **í‰ê·  ì‘ë‹µ ì‹œê°„ (ms)**     | 3             | í‰ê·  ì‘ë‹µ ì‹œê°„ (3ms)                          |
| **ìµœì†Œ ì‘ë‹µ ì‹œê°„ (ms)**     | 1             | ìµœì†Œ ì‘ë‹µ ì‹œê°„ (1ms)                          |
| **ìµœëŒ€ ì‘ë‹µ ì‹œê°„ (ms)**     | 73            | ìµœëŒ€ ì‘ë‹µ ì‹œê°„ (73ms)                         |
| **í‘œì¤€ í¸ì°¨**               | 3.26          | ì‘ë‹µ ì‹œê°„ì˜ í‘œì¤€ í¸ì°¨ (ì‘ë‹µ ì‹œê°„ì´ ë¹„êµì  ì•ˆì •ì ) |
| **ì˜¤ë¥˜ìœ¨**                  | 0.00%         | ì˜¤ë¥˜ ì—†ìŒ                                    |
| **ì²˜ë¦¬ëŸ‰**                  | 66.8/sec      | ì´ˆë‹¹ 66.8ê°œì˜ ìš”ì²­ ì²˜ë¦¬                       |
| **ìˆ˜ì‹  ë°ì´í„°ëŸ‰ (KB/sec)**  | 10.82 KB/sec  | ì´ˆë‹¹ ìˆ˜ì‹  ë°ì´í„°ëŸ‰                           |
| **ì†¡ì‹  ë°ì´í„°ëŸ‰ (KB/sec)**  | 8.34 KB/sec   | ì´ˆë‹¹ ì†¡ì‹  ë°ì´í„°ëŸ‰                           |
| **í‰ê·  ì‘ë‹µ í¬ê¸° (Bytes)**  | 166.0         | í‰ê·  ì‘ë‹µ í¬ê¸° (166 ë°”ì´íŠ¸)                   |

---

### **ğŸ“ˆ ì„±ëŠ¥ ë¶„ì„**
1. **ì „ì²´ì ìœ¼ë¡œ ì‘ë‹µ ì†ë„** 
   - í‰ê·  ì‘ë‹µ ì‹œê°„: **3ms**
   - ìµœëŒ€ ì‘ë‹µ ì‹œê°„ë„ **73ms**ë¡œ í¬ê²Œ ì§€ì—°ë˜ì§€ ì•ŠìŒ.
   - **ë ˆë””ìŠ¤ ë° API ì‘ë‹µ ì‹œê°„ì´ ë¹ ë¦„**

2. **ì²˜ë¦¬ëŸ‰ì´ ì´ˆë‹¹ 66.8ê°œ**
   - ì´ˆë‹¹ **66.8ê°œì˜ ìš”ì²­ì„ ì²˜ë¦¬** ê°€ëŠ¥.
   - 1ë¶„(60ì´ˆ) ë™ì•ˆ **66.8 Ã— 60 â‰ˆ 4,008ê±´ì˜ ìš”ì²­** ì²˜ë¦¬ ì˜ˆìƒ â†’ ì‹¤ì œë¡œ 4,000ê±´ì˜ ìš”ì²­ì´ ìˆ˜í–‰ë¨.
   - í˜„ì¬ ì‹œìŠ¤í…œì´ **ì´ˆë‹¹ ì•½ 66~67ê±´ì˜ ìš”ì²­ì„ ì²˜ë¦¬ ê°€ëŠ¥**

---

### **ğŸš€ ê°œì„ ì´ í•„ìš”í•œ ì **

- ê¸°ì¡´ì˜ 30ì´ˆë‹¹ 500ëª… í™œì„±í™” ë°©ì‹ì€ í•œ ë²ˆì— ë§ì€ ì‚¬ìš©ìê°€ í™œì„±í™”ë˜ì–´ í›„ì† API(ì½˜ì„œíŠ¸ ì¡°íšŒ, ì¢Œì„ ì¡°íšŒ, ì˜ˆì•½)ì— ê¸‰ê²©í•œ ë¶€í•˜ë¥¼ ì¤„ ê°€ëŠ¥ì„±ì´ ìˆìŒ
   - **ê°œì„ ëœ ì „ëµ:**
      - **5ì´ˆë‹¹ 20ëª… í™œì„±í™”** (ì¦‰, ì´ˆë‹¹ ì•½ 4ëª… í™œì„±í™”)
      - ì´ë¥¼ í†µí•´ í™œì„± í† í°ì„ ê°€ì§„ ì‚¬ìš©ìê°€ ì ì§„ì ìœ¼ë¡œ ì½˜ì„œíŠ¸ ì¡°íšŒ, ì¢Œì„ ì¡°íšŒ, ì˜ˆì•½ ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•˜ì—¬, ì „ì²´ ë¶€í•˜ê°€ ë¶„ì‚°ë˜ê³  ì•ˆì •ì ì¸ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•´ì§
---

### **ğŸ“ ê²°ë¡  ë° ì¶”ì²œ ì„¤ì •**
- í˜„ì¬ 4,000ê±´ì˜ ìš”ì²­ì€ ì´ˆë‹¹ 66.8ê±´ ì²˜ë¦¬ë˜ì–´ 1ë¶„(60ì´ˆ) ë‚´ì— ëª¨ë‘ ì²˜ë¦¬
- í•˜ì§€ë§Œ, 10,000ëª… ì‚¬ìš©ìë¥¼ ëª©í‘œë¡œ í•  ê²½ìš° ì´ˆë‹¹ 166ê±´ ì´ìƒì˜ ìš”ì²­ ì²˜ë¦¬ê°€ í•„ìš”
- í† í° í™œì„±í™” ì „ëµì„ **5ì´ˆë‹¹ 20ëª… í™œì„±í™”**ë¡œ ì¡°ì •í•˜ì—¬, ì‚¬ìš©ìê°€ ì ì§„ì ìœ¼ë¡œ ì½˜ì„œíŠ¸ ì¡°íšŒ, ì¢Œì„ ì¡°íšŒ, ì˜ˆì•½ ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê²Œ í•¨ìœ¼ë¡œì¨ ë¶€í•˜ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ë¶„ì‚°

---

## **ì½˜ì„œíŠ¸ ì¡°íšŒ ì„±ëŠ¥ ê°œì„  ë³´ê³ ì„œ**

### **âœ…** ì¹´í…Œê³ ë¦¬ë³„ ë¶„ë¥˜ëœ ì½˜ì„œíŠ¸ë¥¼ ì¼ìê°€ ê°€ê¹Œìš´ ìˆœìœ¼ë¡œ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬

```sql
SELECT c 
FROM Concert c 
WHERE c.category = :category 
  AND c.concertDate >= :today 
ORDER BY c.concertDate ASC 
LIMIT 30;
```

### ì¿¼ë¦¬ ì„ ì • ì´ìœ 

- **ì‚¬ìš© ë¹ˆë„ê°€ ë†’ì€ í•µì‹¬ ê¸°ëŠ¥**: íŠ¹ì • ì¹´í…Œê³ ë¦¬ë³„ ìµœì‹  ì½˜ì„œíŠ¸ë¥¼ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥ì€ ì‚¬ìš©ìê°€ ìì£¼ í™œìš©í•  ê°€ëŠ¥ì„±ì´ ë†’ìŒ
- **ì„±ëŠ¥ ìµœì í™” í•„ìš”**: ë°ì´í„°ê°€ ì¦ê°€í• ìˆ˜ë¡ ì„±ëŠ¥ ì €í•˜ê°€ ì˜ˆìƒë˜ë¯€ë¡œ ì¸ë±ìŠ¤ë¥¼ í™œìš©í•œ ìµœì í™”ê°€ í•„ìš”
- **ORDER BY + LIMIT êµ¬ì¡°**: ìµœì‹  ì½˜ì„œíŠ¸ 30ê°œë§Œ ë¹ ë¥´ê²Œ ì¡°íšŒí•˜ê¸° ìœ„í•´ ì •ë ¬ ë° ìµœì í™” í•„ìš”

### **âœ…**Â ì¸ë±ìŠ¤ ì„¤ì •

```sql
CREATE INDEX idx_concert_category_date 
ON tb_concert (category, concert_date);
```

### **ğŸ“Œ ì¸ë±ìŠ¤ ì ìš© ì´ìœ **

- **WHERE ì¡°ê±´ ìµœì í™”**
   - `category`ê°€ íŠ¹ì • ê°’ìœ¼ë¡œë§Œ í•„í„°ë§ (ì˜ˆ: "Rock", "Jazz" ë“±)
   - `concertDate`ê°€ ì˜¤ëŠ˜ ì´í›„ì˜ ë°ì´í„°ë§Œ ì¡°íšŒ
- **ë³µí•© ì¸ë±ìŠ¤(category, concertDate)ì˜ ì¥ì **
   - `category` ë‹¨ì¼ ì¸ë±ìŠ¤ë§Œ ìˆì„ ê²½ìš° `concertDate` í•„í„°ë§ ì‹œ ì¶”ê°€ì ì¸ í…Œì´ë¸” ìŠ¤ìº” ë°œìƒ
   - `concertDate` ë‹¨ì¼ ì¸ë±ìŠ¤ë§Œ ìˆì„ ê²½ìš° `category` í•„í„°ë§ì´ ìµœì í™” ë¶ˆê°€
   - ë³µí•© ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ **category í•„í„°ë§ í›„, concertDate ì •ë ¬ì´ ì¦‰ì‹œ ìˆ˜í–‰**ë˜ì–´ ë¶ˆí•„ìš”í•œ ì •ë ¬ ì—°ì‚°ì„ í”¼í•  ìˆ˜ ìˆë‹¤
- **ORDER BY ìµœì í™”**
   - `concertDate ASC` ì •ë ¬ì„ ìœ„í•´ ì¸ë±ìŠ¤ë¥¼ í™œìš©í•˜ì—¬ ì •ë ¬ ë¹„ìš©ì„ ìµœì†Œí™” ê°€ëŠ¥
- **LIMIT ìµœì í™”**
   - ì¸ë±ìŠ¤ë¥¼ í™œìš©í•˜ì—¬ í•„ìš” ë°ì´í„°ë§Œ ë¹ ë¥´ê²Œ ì¡°íšŒ ê°€ëŠ¥

### **ğŸ“Š ì¸ë±ìŠ¤ ì¶”ê°€ ì „í›„ ì„±ëŠ¥ ë¹„êµ ë¶„ì„**

| í•­ëª© | ì¸ë±ìŠ¤ ì‚¬ìš© (range) | ì¸ë±ìŠ¤ ì—†ìŒ (ALL) |
| --- | --- | --- |
| **type** |  ë¶€ë¶„ ë²”ìœ„ ê²€ìƒ‰ | Full Table Scan |
| **possible_keys** | `idx_concert_category_date` | `NULL` |
| **key (ì‚¬ìš©ëœ ì¸ë±ìŠ¤)** | `idx_concert_category_date` | `NULL` |
| **rows (íƒìƒ‰ ë ˆì½”ë“œ ìˆ˜)** | 1,965 | 696,873 |
| **Extra** | `Using index condition` (ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•œ í•„í„°ë§) | `Using where; Using filesort` (ì „ì²´ ê²€ìƒ‰ + ì •ë ¬) |
| **ì„±ëŠ¥** | âœ… ìµœì í™” | ğŸš¨ ì„±ëŠ¥ ì €í•˜  |

### **1ï¸âƒ£ ì„±ëŠ¥ ë¹„êµ ê²°ê³¼**

| | ì¼ë°˜ ì¡°íšŒ         | Index ì¡°íšŒ      |  
|----------|---------------|---------------| 
| Query_ID | Duration(sec) | Duration(sec) |
| 1        | 0.253357      | 0.0256965     |
| 2        | 0.24083475    | 0.00165875    |
| 3        | 0.1990175     | 0.001483      |
| 4        | 0.19270775    | 0.0016495     |
| 5        | 0.19753225    | 0.00088       |
| 6        | 0.19948975    | 0.0026395     |
| 7        | 0.19033125    | 0.00276575    |
| 8        | 0.19221575    | 0.00127775    |
| 9        | 0.2006435     | 0.001577      |
| 10       | 0.192198      | 0.001149      |
| í‰ê·        | 0.20583275    | 0.004077675   |

### **ì¸ë±ìŠ¤ ì ìš© í›„ í‰ê·  ì‹¤í–‰ ì†ë„ ê°ì†Œ ë¹„ìœ¨:**

| **ì¡°íšŒ ë°©ì‹** | **í‰ê·  ì‹¤í–‰ ì‹œê°„ (ì´ˆ)** |
| --- | --- |
| **ì¼ë°˜ ì¡°íšŒ (ì¸ë±ìŠ¤ ì—†ìŒ)** | **0.2058 ì´ˆ** |
| **ì¸ë±ìŠ¤ ì‚¬ìš© ì¡°íšŒ** | **0.0041 ì´ˆ** |

### **ì„¸ë¶€ì ì¸ ë¶„ì„**

- **ìµœì•…ì˜ ê²½ìš° (`0.2534` ì´ˆ â†’ `0.0257` ì´ˆ)**
   - **ì•½ 10ë°° í–¥ìƒ**
- **ìµœìƒì˜ ê²½ìš° (`0.1903` ì´ˆ â†’ `0.00088` ì´ˆ)**
   - **ì•½ 200ë°° í–¥ìƒ**
- **ì „ë°˜ì ìœ¼ë¡œ ëª¨ë“  ì¿¼ë¦¬ê°€ `0.005ì´ˆ` ì´í•˜ë¡œ ë‹¨ì¶•ë¨**


### **ì™œ ì´ë ‡ê²Œ ì°¨ì´ê°€ ë°œìƒí–ˆëŠ”ê°€?**

âœ… **ì¸ë±ìŠ¤ ì ìš© ì „**

- **Full Table Scan (ALL) ë°œìƒ** â†’ ë¶ˆí•„ìš”í•œ ë ˆì½”ë“œ íƒìƒ‰ìœ¼ë¡œ ì‹¤í–‰ ì†ë„ ì €í•˜
- **ì •ë ¬ ê³¼ì •ì—ì„œ ì¶”ê°€ì ì¸ filesort ë°œìƒ** â†’ ì •ë ¬ ì—°ì‚° ë¹„ìš© ì¦ê°€

âœ… **ì¸ë±ìŠ¤ ì ìš© í›„**

- **ë³µí•© ì¸ë±ìŠ¤(category, concertDate) í™œìš©**
   - `category` í•„í„°ë§ í›„ `concertDate` ê¸°ì¤€ ì •ë ¬ ìµœì í™”
   - **ë¶ˆí•„ìš”í•œ ì •ë ¬ ì—°ì‚° ì œê±°** â†’ filesort ë°©ì§€
   - **ë¹ ë¥¸ í˜ì´ì§• ì²˜ë¦¬ ê°€ëŠ¥ (LIMIT 30 ìµœì í™”)**


### **âœ… ê²°ë¡ **

- **ë‹¨ìˆœ ì¡°íšŒ ëŒ€ë¹„ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•œ ì¡°íšŒê°€ í‰ê· ì ìœ¼ë¡œ 98% ì´ìƒ ë¹ ë¥´ë‹¤.**
- **ëŒ€ëŸ‰ ë°ì´í„° í™˜ê²½ì—ì„œ ì¸ë±ìŠ¤ëŠ” í•„ìˆ˜ì ì´ë¼ê³  ìƒê°í•˜ê³  WHERE + ORDER BY + LIMIT êµ¬ì¡°ì—ì„œ ë§¤ìš° íš¨ê³¼ì ì´ë¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.**
